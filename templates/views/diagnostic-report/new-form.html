<div class="contenedor_max formIngreso">
    <div class="title-form ancho_diagnostico">
        <div class="row">
            <h4 ng-if="enableEdition">{{_id?'Edite':'Genere'}} {{'YOUR_REPORT_AND_PRESS_SAVE' | translate}}</h4>
            <a class="btn-add btn waves-effect waves-light right" ui-sref="diagnostic_report_print({id:_id})"><i class="fa fa-print ng-scope" aria-hidden="true" tooltipped data-position="top"
                data-delay="50" data-tooltip="{{'PRINT' | translate}}"></i></a>
            <a ng-show="enableEdition && practitionerRole !== 'CLIENT'" class="btn-add btn waves-effect waves-light right ng-binding" ng-click="saveDiagnosticReport()"
                tooltipped data-position="top" data-delay="50" data-tooltip="{{'SAVE_AND_SEND_REPORT' | translate}}"><i class="fa fa-save"></i></a>
            <a ng-show="enableEdition && practitionerRole !== 'CLIENT'" data-target='modal' modal class="btn-add btn waves-effect waves-light right sinchronous_button"  tooltipped data-position="top" data-delay="50" data-tooltip="{{'REJECT_PROCEDURE_REQUEST' | translate}}"><i class="fa fa-ban"></i></a>
            <a class="btn-add btn waves-effect waves-light right" ng-click="cancelDiagnosticReport()"><i class="fa fa-mail-reply ng-scope" aria-hidden="true" tooltipped data-position="top"
                data-delay="50" data-tooltip="{{'GO_TO_LIST' | translate}}"></i></a>
        </div>
    </div>
    <form>
        <div class="row">
            <div class="card-content new-order">
                <div class="row">
                    <div class="buttons-form">
                        <div class="center tabs-form row">
                            <div class="col s12 m12 l12">
                                <ul tabs reload="allTabContentLoaded">
                                    <li class="tab new-report-tab"><a href="#general" ng-click="selectedTab('generalLi')" id="generalLi" tooltipped data-position="top"
                                            data-delay="50" data-tooltip="{{'GENERAL' | translate}}">{{'GENERAL' | translate}}<p>1</p></a></li>
                                    <li class="tab new-report-tab"><a href="#solicitud" ng-click="selectedTab('solicitudLi')" id="solicitudLi" tooltipped
                                            data-position="top" data-delay="50" data-tooltip="{{'REQUEST' | translate}}">{{'REQUEST' | translate}}<p>2</p></a></li>
                                    <li class="tab new-report-tab"><a href="#examen_fisico" ng-click="selectedTab('examen_fisicoLi')" id="examen_fisicoLi"
                                            tooltipped data-position="top" data-delay="50" data-tooltip="{{'PHYSICAL_EXAM' | translate}}">{{'PHYSICAL_EXAM' | translate}}<p>3</p></a></li>
                                    <li class="tab new-report-tab"><a href="#estudios" ng-click="selectedTab('estudiosLi')" id="estudiosLi" tooltipped data-position="top"
                                            data-delay="50" data-tooltip="{{'STUDIES' | translate}}">{{'STUDIES' | translate}}<p>4</p></a></li>
                                    <li class="tab new-report-tab"><a href="#antecedentes" ng-click="selectedTab('antecedentesLi')" id="antecedentesLi"
                                            tooltipped data-position="top" data-delay="50" data-tooltip="{{'BACKGROUND' | translate}}">{{'BACKGROUND' | translate}}<p>5</p></a></li>
                                    <li class="tab new-report-tab"><a href="#notas" ng-click="selectedTab('notasLi')" id="notasLi" tooltipped data-position="top"
                                            data-delay="50" data-tooltip="{{'NOTES' | translate}}">{{'NOTES' | translate}}<p>6</p></a></li>
                                    <li class="tab new-report-tab"><a href="#reporte" ng-click="selectedTab('reporteLi')" id="reporteLi" class="active"
                                            tooltipped data-position="top" data-delay="50" data-tooltip="{{'DIAGNOSTIC_REPORT' | translate}}">{{'DIAGNOSTIC_REPORT' | translate}}<p>7</p></a></li>
                                </ul>
                            </div>
                        </div>
                        <a ng-if="initPosition !== 0" class="ileft" ng-click="chevron({position: initPosition - 1})" href=""><i class="material-icons">chevron_left</i></a>
                        <a ng-if="initPosition !== (chevronOptions.length -1)" class="iright" ng-click="chevron({position: initPosition + 1})" href=""><i class="material-icons">chevron_right</i></a>
                    </div>
                </div>
                <div id="general" class="col s12">

                    <div class="card-content">
                        <div class="row">
                            <div class="col m12 s12">
                                <div ng-if="patientInfoExist" class="col s12" style="padding:0">
                                    <div class="input-field col l6 m6 s6" style="margin-top: 0px !important" ng-cloak>
                                        <p class="est-label">{{'PATIENT' | translate}}</p>
                                        <input id="subject" type="text" class="validate" ng-model="diagnosticOrder.subject.display" readonly />
                                    </div>
                                    <div class="input-field col l6 m6 s6" style="margin-top: 0px !important">
                                        <p class="est-label">{{'PERSONAL_IDENTIFICATION' | translate}}</p>
                                        <input id="subject" type="text" class="validate" ng-model="diagnosticOrder.subject.identifier[0].value" readonly style="margin-left: 2px"
                                        />
                                    </div>
                                </div>
                                <div class="col s12" style="padding:0">
                                    <div class="input-field col l6 m6 s6" style="margin-top: 0px !important">
                                        <p class="est-label">{{'AGE' | translate}}</p>
                                        <input id="subject" type="text" class="validate" ng-model="diagnosticOrder.subject.age" readonly />
                                    </div>
                                    <div class="input-field col l6 m6 s6" style="margin-top: 0px !important">
                                        <p class="est-label">{{'GENDER' | translate}}</p>
                                        <input id="subject" type="text" class="validate" ng-model="diagnosticOrder.subject.gender" readonly style="margin-left: 2px"
                                        />
                                    </div>
                                </div>
                                <div class="col s12" style="padding:0">
                                    <div class="input-field col l6 m6 s6" style="margin-top: 0px !important">
                                        <p class="est-label">{{'ORGANIZATION' | translate}}</p>
                                        <input id="subject" type="text" class="validate" ng-model="diagnosticOrder.performer.display" readonly />
                                    </div>
                                    <div class="input-field col l6 m6 s6" style="margin-top: 0px !important">
                                        <p class="est-label">{{'SPECIALTY' | translate}}</p>
                                        <input id="subject" type="text" class="validate" ng-model="diagnosticOrder.performerType.text" readonly style="margin-left: 2px"
                                        />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="solicitud" class="col s12">

                    <div class="col m6 s12">
                        <label for="title">{{'TITLE' | translate}}</label>
                        <input ng-readonly="!EnableEdit" id="title" type="text" class="validate" ng-model="diagnosticOrder.identifier[0].system"
                        />
                        <div ng-if="msg" class="msj-error">
                            <a href="" class="close"><i class="material-icons">clear</i></a>
                            <p><i class="material-icons">report_problem</i>{{'TITLE_IS_REQUIRED' | translate}}</p>
                        </div>
                    </div>
                    <div class="col m6 s12">
                        <label for="email">{{'REASON_OPTIONAL' | translate}}</label>
                        <input ng-readonly="!EnableEdit" id="email" type="text" class="validate" ng-model="diagnosticOrder.code.text" />
                        <span></span>
                    </div>
                    <div class="col m6 s12 sincronica">
                        <label for="type">{{'TYPE' | translate}}</label>
                        <input readonly id="type" type="text" class="validate" ng-value="diagnosticOrder.category[0].text | translate" />
                    </div>
                    <div class="col m6 s12">
                        <label for="title">{{'STATUS' | translate}}</label>
                        <input ng-readonly="!EnableEdit" id="status-request" type="text" class="validate" ng-value="diagnosticOrder.status | translate"
                        />
                    </div>
                </div>
                <div id="examen_fisico" class="col s12">
                    <physical-exam enable-edit="EnableEdit" entry="entry" physical-exam="physicalExam"></physical-exam>
                </div>
                <div id="estudios" class="col s12">

                    <div class="col m6 s12">
                        <p ng-if="!EnableEdit">{{'IN_THIS_SECTION_YOU_CAN_VIEW_ALL_PATIENT_STUDIES_RELEVANT_TO_THE_APPLICATION_AND_OR_THE_POSSIBILITY_OF_GENERATING_STUDIES_IF_WORKING_FROM_A_CDM'
                            | translate}} <br><br> <span>{{'ALL_FILES_CORRESPONDING_TO_THE_SAME_STUDY_MUST_BE_OF_THE_SAME_TYPE_AND_SIZE' | translate}}</span></p>
                    </div>
                    <div class="col s12">
                        <p ng-if="diagnosticOrder.supportingInfo.length === 0">{{'REQUEST_WITHOUT_STUDIES' | translate}}</p>
                        <ul class="collection files-col">
                            <li class="collection-item" ng-repeat="observation in attachedObservations">
                                <span class="title" ng-click="observationDetail(observation)"><a >{{observation.valueString || observation._id}} <i class="fa fa-eye right preview" aria-hidden="true"></i></a></span>
                                <span ng-if="EnableEdit" class="right cancel_study" ng-click="removeObservation(observation)"> <a><img src="img/iconos/delete.png" class="cruz" aria-hidden="true"></a></span>
                            </li>
                        </ul>
                        <study-viewer ng-if="currentObservation._id && notIsDicom" attachment="currentObservation.attachment" study-name="currentObservation.studyName"
                            save-attachment="saveAttachment" select-attachment="selectAttachment"></study-viewer>
                        <study-dicom ng-if="currentObservation._id" current-attachment="currentObservation.attachment[0]" no-dicom="notIsDicom" attachment="currentObservation.attachment"></study-dicom>
                    </div>
                    <file-modal attachment="attachment" save="saveAttachment" type="'multiple'" study-name="studyName" accept-callback="saveNewStudy"
                        status="modalStatus"></file-modal>
                </div>
                <div id="antecedentes">

                    <p class="explicacion2"> • {{'CHECK_ALL_THE_OPTIONS_FOR_THE_PATIENT_IN_QUESTION' | translate}}</p>
                    <background enable-edit="EnableEdit" entry="entry" toxic-habits="toxicHabits" psysiologic-habits='psysiologicHabits' chillhood-diseases='chillhoodDiseases'
                        horizontal-transmition-diseases='horizontalTransmitionDiseases' adult-diseases='adultDiseases'></background>
                </div>
                <div id="notas" class="col s12">

                    <p class="explicacion2"> • {{'IF_NECESSARY_ADD_A_NOTE_TO_THE_MEDICAL_PROVIDER' | translate}}</p>
                    <ul class="collection files-col">
                        <li class="collection-item avatar prestador" ng-repeat="item in diagnosticOrder.note" ng-class="item.authorReference.reference === diagnosticOrder.requester.agent.reference?'cliente':'prestador'"
                            ng-if="item.text">
                            <span class="title">{{item.authorString}} - {{ {date: item.time.type, type: 'time'} | setViewDate}}</span>
                            <p>{{item.text}}</p>
                        </li>
                    </ul>
                    <div class="row">
                        <div class="msj-chat">
                            <input-field>
                                <textarea id="note" placeholder="{{placeHolderNote}}" maxlength="140" class="filled-in" ng-model="noteinfo.currentNote" ng-keydown="$event.keyCode == 13 && sendNote() "></textarea>
                            </input-field>
                            <button id="sendNote" class="waves-effect waves-teal btn-add btn" ng-click="sendNote()" type="submit" name="action" tooltipped data-delay="50" data-position="top" data-tooltip="{{'THIS_ACTION_WILL_SEND_THE_NOTE_FOR_CLARIFICATION_WITHOUT_GENERATING_A_REPORT' | translate}}"><i class="fa fa-commenting" aria-hidden="true"></i>{{commentStr}}</button>
                        </div>
                        <div class="clearfix"></div>
                        <div ng-if="unsaved_notes" class="msj-error">
                            <a href="" class="close"><i class="material-icons">clear</i></a>
                            <p><i class="material-icons">report_problem</i>{{'THERE_ARE_UNSAVED_NOTES' | translate}}</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col m12" ng-if="reports.length > 0">
                            <div class="row">
                                <div class="input-field col s12">
                                    <label for="reference">{{REPORT_LIST | translate}} </label>
                                </div>
                                <div class="input-field col s12" ng-repeat="report in reports">
                                    <a ui-sref="diagnostic_report_add({id:report._id})" class="black-text">
                                        <input id="reference" type="text" ng-model="report._id" readonly/>
                                        <span></span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div ng-show="errorMsg" class="card-info">
                  <p class="msj-error"><a href="" class="close"><i class="material-icons">clear</i></a><i class="material-icons">report_problem</i>{{'THE_CONCLUSION_MUST_HAVE_A_MINIMUM_OF_10_CHARACTERS' | translate}}</p>
                </div>
                <div id="reporte" class="col s12">

                    <div class="card-content">
                        <div class="row">
                            <div class="col s12">
                                <div class="title-form reduce-margin">
                                    <h6>{{'CONCLUSION' | translate}}</h6>
                                </div>
                                <div class="row">
                                    <div class="row">
                                        <div class="input-field col s12">
                                            <textarea ng-model="data.conclusion" class="validate materialize-textarea black-text" type="text" ng-readonly="!enableEdition"></textarea>
                                            <span></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="title-form reduce-margin">
                                    <h6>{{'MODIFICATIONS' | translate}}</h6>
                                </div>
                                <div class="row">
                                    <div class="row">
                                        <div class="col s3">
                                            <label for="use_address">{{'DATE' | translate}}</label>
                                        </div>
                                        <div class="col s3">
                                            <label for="use_address">{{'REASON' | translate}}</label>
                                        </div>
                                        <div class="col s3">
                                            <label for="use_address">{{'MADE_BY' | translate}}</label>
                                        </div>
                                        <div class="col s3">
                                            <label for="use_address">{{'STATUS' | translate}}</label>
                                        </div>
                                    </div>
                                    <div class="row border-bottom">
                                        <div class="col s3">
                                            <p id="use_address" type="text" class="validate not-border" ng-value="diagnosticOrder.createdAt" readonly>{{diagnosticOrder.createdAt}}</p>
                                        </div>
                                        <div class="col s3">
                                            <p>{{'PROCEDURE_CREATION' | translate}}</p>
                                        </div>
                                        <div class="col s3">
                                            <p id="use_address" type="text" class="validate not-border truncate" ng-value="diagnosticOrder.requester.agent.display" readonly>{{diagnosticOrder.requester.agent.display}}</p>
                                        </div>
                                        <div class="col s3">
                                            <p id="use_address" type="text" class="validate not-border truncate" value="Solicitado" readonly>{{'REQUESTED' | translate}}</p>
                                        </div>
                                    </div>
                                    <div ng-if="performer.display" class="row border-bottom">
                                        <div class="col s3">
                                            <p id="use_address" type="text" class="validate not-border" ng-value="diagnosticOrder.createdAt" readonly>{{diagnosticOrder.createdAt}}</p>
                                        </div>
                                        <div class="col s3">
                                            <p>{{'PROCEDURE_RESPONSE' | translate}}</p>
                                        </div>
                                        <div class="col s3">
                                            <p id="use_address" type="text" class="validate not-border truncate" readonly>{{performer.display}}</p>
                                        </div>
                                        <div class="col s3">
                                            <p id="use_address" type="text" class="validate not-border truncate" value="Solicitado" readonly>{{'REPORT_GENERATED' | translate}}</p>
                                        </div>
                                    </div>
                                    <div ng-if="diagnosticOrder.updatedAt !== diagnosticOrder.createdAt" class="row border-bottom">
                                        <div class="col s3">
                                            <p id="use_address" type="text" class="validate not-border" readonly>{{diagnosticOrder.createdAt}}</p>
                                        </div>
                                        <div class="col s3">
                                            <p>{{'PROCEDURE_REFRESH' | translate}}</p>
                                        </div>
                                        <div class="col s3">
                                            <p id="use_address" type="text" class="validate not-border truncate" readonly>{{diagnosticOrder.requester.agent.display}}</p>
                                        </div>
                                        <div class="col s3">
                                            <p id="use_address" type="text" class="validate not-border truncate" value="Solicitado" readonly>{{ {date: diagnosticOrder.status, type: 'time'} | setViewDate}}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="separador"></div>

                            </div>
                            <div ng-show="!procedureCompleted">
                                <a ng-show="!isCancelled && username === diagnosticOrder.requester.agent.display" class="btn-add btn waves-effect waves-light"
                                    ng-click="endRequest()"><i class="fa fa-stop" aria-hidden="true" tooltipped data-position="top"
                                        data-delay="50" data-tooltip="{{'FINISH_AND_CLOSE_DIAGNOSTIC' | translate}}"></i></a>
                                <a ng-show="!isCancelled && username === diagnosticOrder.requester.agent.display" class="btn-add btn waves-effect waves-light"
                                    data-target='modal_motivo_resend' modal><i class="fa fa-fast-forward" aria-hidden="true" tooltipped data-position="top"
                                        data-delay="50" data-tooltip="{{'REJECT_AND_RESEND' | translate}}"></i></a>
                                <a ng-show="!isCancelled && username === diagnosticOrder.requester.agent.display" class="btn-add btn waves-effect waves-light"
                                    ng-click="receivedProcedure()"><i class="fa fa-ban" aria-hidden="true" tooltipped data-position="top"
                                        data-delay="50" data-tooltip="{{'REJECT' | translate}}"></i></a>
                                <a ng-show="!isCancelled && username === diagnosticOrder.requester.agent.display" class="btn-add btn waves-effect waves-light"
                                    data-target='modalRejectAndResend' modal><i class="fa fa-binoculars" aria-hidden="true"  tooltipped data-position="top"
                                        data-delay="50" data-tooltip="{{'REVISION' | translate}}"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<div id="modal" class="modal">
  <div class="modal-content">
    <div class="input-field">
      <label class="reason-label">{{'REASON' | translate}}:</label>
      <input type="text" ng-model="reason">
      <a ng-click="rejectProcedureRequest()" class="modal-action modal-close btn-add btn waves-effect waves-light right"><i class="fa fa-thumbs-down" aria-hidden="true"></i>{{'CONFIRM_REJECT_PROCEDURE_REQUEST' | translate}}</a>
    </div>
  </div>
</div>

<div id="modalRejectAndResend" class="modal">
    <div class="modal-content">
        <div class="input-field">
            <label class="reason-label">{{'REASON' | translate}}:</label>
            <input type="text" ng-model="reason">
            <a ng-click="revisionDiagnostic()" class="modal-action modal-close btn-add btn waves-effect waves-light right">{{'CONFIRM_REVISION_DIAGNOSTIC' | translate}}</a>
        </div>
    </div>
</div>

<div id="modal_motivo_resend" class="modal">
    <div class="modal-content">
        <div class="new-order">
            <h6>{{'REASON' | translate}}:</h6>
        </div>
        <div class="input-field">
            <input type="text" ng-model="reasonResend" placeholder="{{'INSERT_YOUR' | translate}} {{'REASON' | translate}}">
            <a class="modal-action modal-close btn-add btn waves-effect waves-light right" ng-click="rejectAndResendProcedure()">{{'ACCEPT' | translate}}</a>
            <a class="modal-action modal-close btn-add btn waves-effect waves-light right"><i class="fa fa-window-close-o" aria-hidden="true"></i>{{'CANCEL' | translate}}</a>
        </div>
    </div>
</div>


<div id="modal10" class="modal modal10">
  <div class="modal-content">
    <p class="text-in-box">{{'THE_REPORT_FOR_THE_PROCEDURE_TITLE_HAS_BEEN_SAVED' | translate}} {{diagnosticOrder.identifier[0].system}}</p>
  </div>
  <div class="modal-footer">
    <a id="acept_modal" href="#!" class="modal-action modal-close waves-effect waves-light btn btn-add" ui-sref="diagnostic_report_abm">{{'ACCEPT' | translate}}</a>
  </div>
</div>

<div id="modal-discard" class="modal modal-discard">
  <div class="modal-content">
    <p class="text-in-box">{{'EXITING_THIS_SCREEN_WILL_CAUSE_CANCELLATION_IN_THE_COURSE_DO_YOU_CONFIRM_THE_EXIT' | translate}}</p>
  </div>
  <div class="modal-footer">
    <a id="acept_modal_redirec" class="modal-action waves-effect waves-light btn btn-add button-draft" ng-click="gotoMenu()" tooltipped data-position="top" data-delay="50" data-tooltip="{{'EXIT' | translate}}">{{'YES' | translate}}</a>
    <a id="cancel_modal_redirec" class="modal-action modal-close waves-effect waves-light btn btn-add button-draft" ng-click="returntoForm()"  tooltipped data-position="top" data-delay="50" data-tooltip="{{'CANCEL_AND_RETURN_TO_THE_REPORT' | translate}}">{{'NO' | translate}}</a>
  </div>
</div>
